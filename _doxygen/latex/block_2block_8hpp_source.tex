\doxysection{block.\+hpp}
\hypertarget{block_2block_8hpp_source}{}\label{block_2block_8hpp_source}\index{liblava/block/block.hpp@{liblava/block/block.hpp}}
\mbox{\hyperlink{block_2block_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{device_8hpp}{liblava/base/device.hpp}}"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{namespace\ }lava\ \{}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structlava_1_1command}{command}}\ :\ \mbox{\hyperlink{structlava_1_1entity}{entity}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1command_adb70243f4ea77a7cb57f91475b5ab53e}{s\_ptr}}\ =\ std::shared\_ptr<command>;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1command_a172d078716731eff9ac86200e34dcecd}{c\_ptr}}\ =\ \mbox{\hyperlink{structlava_1_1command}{command}}\ \textcolor{keyword}{const}*;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1command_ad9c87f65181226619252146f936d4a2f}{s\_map}}\ =\ std::map<id,\ s\_ptr>;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1command_a0b3001d7f3be692a50bbf537a59ffeb2}{c\_list}}\ =\ std::vector<c\_ptr>;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_ace97a755b9ed66f2467c625c05a29c0e}{VkCommandBuffers}}\ \mbox{\hyperlink{structlava_1_1command_ab22326abef17e815271192455b48f252}{buffers}}\ =\ \{\};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1command_aea5fb742f88010683d2ea34a1c81bb76}{process\_func}}\ =\ std::function<void(VkCommandBuffer)>;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{structlava_1_1command_aea5fb742f88010683d2ea34a1c81bb76}{process\_func}}\ \mbox{\hyperlink{structlava_1_1command_a64d82fae785d7135efe009502331b234}{on\_process}};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1command_ab335e4b5f019d5c3551f05e0b2c1a786}{active}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structlava_1_1command_adb70243f4ea77a7cb57f91475b5ab53e}{s\_ptr}}\ \mbox{\hyperlink{structlava_1_1command_a55e864a11f7e8bb8608ef7c8b3807483}{make}}()\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_shared<command>();}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1command_a052247192d53949422b98e5952f4801d}{create}}(\mbox{\hyperlink{structlava_1_1device}{device::ptr}}\ \mbox{\hyperlink{structlava_1_1device}{device}},}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ frame\_count,}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_afe1ce1f608bd72e59916382d9c3cf615}{VkCommandPools}}\ command\_pools);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structlava_1_1command_ac17fe5c1d7bc4132c9fdb311281368cc}{destroy}}(\mbox{\hyperlink{structlava_1_1device}{device::ptr}}\ \mbox{\hyperlink{structlava_1_1device}{device}},}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_afe1ce1f608bd72e59916382d9c3cf615}{VkCommandPools}}\ command\_pools);}
\DoxyCodeLine{00068\ \};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structlava_1_1block}{block}}\ :\ \mbox{\hyperlink{structlava_1_1entity}{entity}}\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1block}{ptr}}\ =\ \mbox{\hyperlink{structlava_1_1block}{block}}*;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1block_aebd0a7c9d3be269cd4749dbd41ec78f5}{s\_ptr}}\ =\ std::shared\_ptr<block>;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1block_ae30cc03dd2789f3b0c7ef2125dee013b}{c\_ptr}}\ =\ \mbox{\hyperlink{structlava_1_1block}{block}}\ \textcolor{keyword}{const}*;}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1block_afa1a9c5b31fcfcccf2467eac19d26f9c}{s\_map}}\ =\ std::map<id,\ s\_ptr>;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structlava_1_1block_ac8b9e081cd1ed1659385f4770a5b3893}{c\_list}}\ =\ std::vector<c\_ptr>;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structlava_1_1block_aebd0a7c9d3be269cd4749dbd41ec78f5}{s\_ptr}}\ \mbox{\hyperlink{structlava_1_1block_af59243ac0dccc0df36ac159be1987de0}{make}}()\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_shared<block>();}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{structlava_1_1block_ac3392a022afd4387a9a5c17aec8a1139}{\string~block}}()\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structlava_1_1block_a5875f397c600f70f66d205793777d533}{destroy}}();}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1block_a90e2ee2da194d25b073986c2b375fe4e}{create}}(\mbox{\hyperlink{structlava_1_1device}{device::ptr}}\ \mbox{\hyperlink{structlava_1_1device}{device}},}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ frame\_count,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ queue\_family);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structlava_1_1block_a5875f397c600f70f66d205793777d533}{destroy}}();}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ \mbox{\hyperlink{structlava_1_1block_a2d33dd787828f5fdb976df93cfba5660}{get\_frame\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{types_8hpp_a5da1a3211b6ee5bed1b706d8962ad10b}{to\_index}}(m\_cmd\_pools.size());}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordtype}{id}\ \mbox{\hyperlink{structlava_1_1block_a15ddf43bfcdf5e3524ea28ca1495e5b9}{add\_cmd}}(\mbox{\hyperlink{structlava_1_1command_aea5fb742f88010683d2ea34a1c81bb76}{command::process\_func}}\ func,\ \textcolor{keywordtype}{bool}\ active\ =\ \textcolor{keyword}{true});}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{id}\ \mbox{\hyperlink{structlava_1_1block_acb14766b92fb411a8b9dc5adab469084}{add\_command}}(\mbox{\hyperlink{structlava_1_1command_aea5fb742f88010683d2ea34a1c81bb76}{command::process\_func}}\ func,\ \textcolor{keywordtype}{bool}\ active\ =\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structlava_1_1block_a15ddf43bfcdf5e3524ea28ca1495e5b9}{add\_cmd}}(func,\ active);}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structlava_1_1block_afdda663d3950e15bdaea82d0c303ffba}{remove\_cmd}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structlava_1_1block_acb560ae2445f1610bfc7155d3a81d7c6}{remove\_command}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id)\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structlava_1_1block_afdda663d3950e15bdaea82d0c303ffba}{remove\_cmd}}(cmd\_id);}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1block_a1ba35820f45a6702cdab60ea471bf080}{process}}(\mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ \mbox{\hyperlink{structlava_1_1frame}{frame}});}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00167\ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ \mbox{\hyperlink{structlava_1_1block_ac6132a8f9bca3e90648c35f22eaa49fb}{get\_current\_frame}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_current\_frame;}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00176\ \ \ \ \ VkCommandBuffer\ \mbox{\hyperlink{structlava_1_1block_a79bb818384221484733eb1b372e6b9e5}{get\_command\_buffer}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_commands.at(cmd\_id)-\/>buffers.at(m\_current\_frame);}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00186\ \ \ \ \ VkCommandBuffer\ \mbox{\hyperlink{structlava_1_1block_a7bfec0344646503eeb17ea402080d59c}{get\_command\_buffer}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id,\ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ \mbox{\hyperlink{structlava_1_1frame}{frame}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_commands.at(cmd\_id)-\/>buffers.at(\mbox{\hyperlink{structlava_1_1frame}{frame}});}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_ace97a755b9ed66f2467c625c05a29c0e}{VkCommandBuffers}}\ \mbox{\hyperlink{structlava_1_1block_a78728f7d5abc5de61cce17ee2ead2f57}{collect\_buffers}}()\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_ace97a755b9ed66f2467c625c05a29c0e}{VkCommandBuffers}}\ result;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ cmd\ :\ m\_cmd\_order)}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cmd-\/>active)}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result.push\_back(cmd-\/>buffers.at(m\_current\_frame));}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{structlava_1_1command_ad9c87f65181226619252146f936d4a2f}{command::s\_map}}\ \textcolor{keyword}{const}\&\ \mbox{\hyperlink{structlava_1_1block_ad962cd9012179be009da8bdade12bf57}{get\_commands}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_commands;}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{structlava_1_1command_a0b3001d7f3be692a50bbf537a59ffeb2}{command::c\_list}}\ \textcolor{keyword}{const}\&\ \mbox{\hyperlink{structlava_1_1block_a7a05921272711863394d162fe2cb3983}{get\_cmd\_order}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_cmd\_order;}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1block_ab18e296c08b487afea2e1f1ddb679b41}{activated}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id);}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structlava_1_1block_a61dd13bfe64d3715353dd2b1f02718f9}{set\_active}}(\mbox{\hyperlink{structlava_1_1id_a226df789a94177f765bdcaac2988eda0}{id::ref}}\ cmd\_id,\ \textcolor{keywordtype}{bool}\ active\ =\ \textcolor{keyword}{true});}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00239\ \ \ \ \ \mbox{\hyperlink{structlava_1_1device}{device::ptr}}\ \mbox{\hyperlink{structlava_1_1block_ac1ec06d85e3e4b44a7954a1ba38eb840}{get\_device}}()\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_device;}
\DoxyCodeLine{00241\ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00245\ \ \ \ \ \mbox{\hyperlink{structlava_1_1device}{device::ptr}}\ m\_device\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{types_8hpp_a2a40eb7fccb1ebcfd58d6d4b7a078e5c}{index}}\ m\_current\_frame\ =\ 0;}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00251\ \ \ \ \ \mbox{\hyperlink{base_2base_8hpp_afe1ce1f608bd72e59916382d9c3cf615}{VkCommandPools}}\ m\_cmd\_pools\ =\ \{\};}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00254\ \ \ \ \ \mbox{\hyperlink{structlava_1_1command_ad9c87f65181226619252146f936d4a2f}{command::s\_map}}\ m\_commands;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00257\ \ \ \ \ \mbox{\hyperlink{structlava_1_1command_a0b3001d7f3be692a50bbf537a59ffeb2}{command::c\_list}}\ m\_cmd\_order;}
\DoxyCodeLine{00258\ \};}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \}\ \textcolor{comment}{//\ namespace\ lava}}

\end{DoxyCode}
